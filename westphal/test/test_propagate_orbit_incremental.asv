% Define constants
a = 550; %km
e = 0.01; 
OM = 0;
om = 0;
nu0 = 0;
mu = 398600.440; %km³/s²
R_E = 6378;
J_2 = 0.00108263;

% Create instance of function collector
fc = FunctionCollector;

% Calculate inclination for SSO orbit
% https://en.wikipedia.org/wiki/Sun-synchronous_orbit
i = acos(-(a / 12352)^(7/3));

% Calculate orbital period
T = 2 * pi * sqrt(a^3 / mu);

%  Propagate orbit and transform to keplarian elements
t0 = 0;
t1 = 1.5 * T;
t_step = 1;

% Propagate orbit
[nunu, OMOM, rrr, vvv] = fc.propagate_orbit_incremental(a, e, i, OM, om, nu0, mu, t0, t1, t_step, R_E, J_2);

plot3(rrr(:,1), rrr(:, 2), rrr(:,3));
grid on;
xlabel('X'); ylabel('Y'); zlabel('Z');
title('3D Elliptical Orbit');

figure('Name','3D Orbit (ECI)');
plot3(r_eci(:,1), r_eci(:,2), r_eci(:,3), 'LineWidth', 1.0); hold on; grid on; axis equal;
% Draw a translucent Earth
[fX,fY,fZ] = sphere(80);
surf(Re*fX, Re*fY, Re*fZ, 'FaceAlpha', 0.1, 'EdgeColor', 'none'); colormap gray;
xlabel('x_{ECI} [km]'); ylabel('y_{ECI} [km]'); zlabel('z_{ECI} [km]');
title('Unperturbed Keplerian Orbit (ECI/ICRF)');
view(35,25);


